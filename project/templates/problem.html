<html  lang="en">
<head>
	<link href="{{ url_for('static', filename='../statics/css/font-awesome.min.css') }} "rel="stylesheet" />
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Contests</title>
	<link  href="{{ url_for('static', filename='../statics/img/jicon.png') }} " rel="icon" >
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link href="{{ url_for('static', filename='../statics/css/sweetalert.css') }} " rel="stylesheet" />     
    <link href="{{ url_for('static', filename='../statics/css/bootstrap-datetimepicker.min.css') }} " rel="stylesheet" />  
    <link href="{{ url_for('static', filename='../statics/css/style.css') }}" rel="stylesheet" />   
    <link href="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/css/jquery.fileupload-ui.min.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
    <script src="{{ url_for('static', filename='../statics/js/jquery.nicescroll.min.js') }}"  /></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/jquery.fileupload-jquery-ui.min.js"  /></script>
    <script src="{{ url_for('static', filename='../statics/js/sweetalert.min.js') }}"  /></script>   	
	<script src="{{ url_for('static', filename='../statics/js/moment.min.js') }}"/></script>
	<script src="{{ url_for('static', filename='../statics/js/bootstrap-datetimepicker.min.js') }}"  /></script>	    
	

</head>
 


<body>
	<div id="loading" style="text-align:center;position:relative;top:40%"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i> <p>Please wait...</p></div>
<div id="body" style="display:none">
	<ul class=" col-xs-3 col-md-2 leftmenu shadow " id="contestleftmenu" style="display:none">
		
		<li class=" usernameitem " id="contestnameitem">
			<a href="" ><h4 id="getcontestname" class="leftmenuitem">
				<img src="{{ url_for('static', filename='../statics/img/j2.png') }}" height="100%"/></h4> 
			</a>
				  
			<h4 id="getidcontest" style="display:none"></h4>
		</li>			
		<li  id="questions" class=" usernameitem " >
			
		 	<a href="#questions" ><h4 class="leftmenuitem"><i  class="fa fa-code" style="width:20px; height:20px;"> </i> Problems</h4></a>
		</li>		
		<li  id="rank" >
			
		 	<a href=""><h4 class="leftmenuitem"><i  class="fa fa-area-chart" style="width:20px; height:20px;"> </i> Rank list</h4></a>
		</li>		
		<li  id="contestteam"  style="display:none">
		 	<a href="#teams"><h4 class="leftmenuitem"><i class="fa fa-group" style=" width:20px; height:20px; "></i> Teams</h4></a>
		</li>
		<li  id="time"  >
		 	<h4 class="leftmenuitem"><i class="fa fa-clock-o" style=" width:20px; height:20px; "></i> <span id="countdown" class="countdown"></span></h4>
		</li>		
		<li  id="backtoprofile" class="backtoprofile" >
		 	<a href="#back" ><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i> Back to profile</h4></a>
		</li>
		<li  id="backtoproblemlistbtn" class="backtocontest" style="display:none">
		 	<a href="#back" ><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i> Back to list</h4></a>
		</li>

	</ul>
    
<div class="col-xs-offset-3 col-md-offset-2 ">
	<div id="problemhead" class="col-xs-9 col-md-10 maintitr" style="display:none ;text-align:center ">	
		<span id="titleproblem"style="direction:rtl" ></span><span id="orderproblem" style="display:none"></span>	
		<p id="idproblem" class="contestproblem " style="display:none"></p>
		<p id="idteam" class="contestproblem " style="display:none"></p>		
	</div>
</div>
   
	<div class="col-xs-offset-3 col-md-offset-2">
		<div id="contents" class="contents  " >		
			<div id="contestquestions" class="CSSTableGenerator" style="display:none">
				<div id="contestaddquestions" style="display:none; margin:3%;">
					Problem details:
					<hr>
					<label class="labelcss" for="problemtitle">Title: </label>
					<input type="text" name="problemtitle" id="problemtitle" style="width:85%"/><br><br>
					<div class="row"> 
						<label class="labelcss" for="problemtimelimit">Time limit(ms): </label>
						<input type="text" name="problemtimelimit" id="problemtimelimit" style="margin-right:3%; width:35.5%"/>
						<label class="labelcss" for="problemspacelimit">Space limit(kb): </label>
						<input type="text" name="problemspacelimit" id="problemspacelimit" style="width:35.5%"/><br>
					</div>
					<label class="labelcss" for="problemheader">Header: </label>
					<textarea class="textareacss" name="problemheader"  id="problemheader"></textarea><br>
					<label class="labelcss" for="problembody">Body: </label>
					<textarea class="textareacss" name="problembody" id="problembody" ></textarea><br>
					<label class="labelcss" for="problembody">Footer: </label>
					<textarea class="textareacss" name="problemfooter" id="problemfooter" ></textarea><br>
					<hr>
					sample Testcase:<br>
					
					<div class="testcase" id="problemtestcase" >
						<hr>
						<label class="labelcss" for="problemtestcaseinput">Input: </label>
						<textarea class="textareacss" name="problemtestcaseinput" id="problemtestcaseinput" ></textarea><br>
						<label class="labelcss" for="problemtestcaseoutput">Output: </label>
						<textarea class="textareacss" name="problemtestcaseoutput" id="problemtestcaseoutput" ></textarea><br>
					</div>
					<hr>
					<div>
						<button type="submit" id="cancleproblemsubmitbtn" class="btn btn-primary" style="width:15.5%"> Cancle</button>
						<button type="submit"id="addproblemsubmitbtn"  class="btn btn-primary" style="width:15.5%"> Add</button>
										
						<button type="submit" id="editproblemsubmitbtn" class="btn btn-primary" style="width:15.5%"> Submit edit</button>
					</div>
					<div id="addproblemloading" style="display:none">Please wait...</div>
				</div>
				<div id="contestquestion"  style="display:none">
					<div id="contentproblem" class="col-xs-12 col-md-11  contestproblem row">
						<div class="row">					
						<div class="col-lg-6"><span id="contestspacelimitdiv" ></span><span>:(kb)</span><span>محدودیت حافظه</span></div>
						<div class="col-lg-6"><span id="contesttimelimitdiv" ></span><span>:(ms)</span><span>محدودیت زمانی</span></div>
						</div><hr>
						<div style="margin-left:1%;">
						<div id="contestheaderdiv" style="direction:rtl" class="row  "></div><br>
						<div id="contestbodydiv" style="direction:rtl" class="row "></div><br>
						<div id="contestfooterdiv" style="direction:rtl" class="row "></div><br>
						</div>
																						
					</div>
					<hr>
					<div class="row" id="contesttestcaseexamplediv" style="margin-left:1%;width:92%" >
							<hr>
							<label class="labelcss" for="problemtestcaseinput">Input: </label>
							<textarea class="textareacss" name="problemtestcaseinput" id="testcaseinput" readonly  ></textarea><br>
							<label class="labelcss" for="problemtestcaseoutput">Output: </label>
							<textarea class="textareacss" name="problemtestcaseoutput" id="testcaseoutput"  readonly></textarea><br>
						</div>

					
					<div id="contestquestionsubmit" class="col-xs-12 col-md-11  row" style="display:none">
						<br><br>
						<div class="box">
							<div id="contestlanguageproblem"  style="margin-left:1%" class="row">
								
								 <ul class="nav nav-pills"> 
									  <li class="active" data-toggle="pill" ><a id="cpp" href="#">C++</a></li>
									  <li  data-toggle="pill" ><a id="py" href="#">PYTHON</a></li>
									  <li  data-toggle="pill"><a id="java" href="#">JAVA</a></li>
								</ul>
								<br><br>
							</div>
							<div id="submitloading" style="display:none;">Please wait...</div>
							<input type="file" name="file-5[]" id="file-5" class="inputfile inputfile-5" data-multiple-caption="{count} files selected" multiple />
							<label for="file-5"><figure><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg></figure> <span></span></label>
							<br><input type="button" id="submitcode" class="btn btn-primary" value="submit your code"/>
						</div>	        
					</div>

					<div id="addtestcase" class="col-xs-12 col-md-12  row" style="display:none">
							
						<!--<input id="input-1" name="input1[]" type="file"  class="file-loading inputs">/-->	
							<div class="box">
								<p > Add testcase file for this problem. Please upload your ZIP file </p>
								<div id="testcaseloading" style="display:none">Please wait...</div>
								<input type="file" name="file-6[]" id="file-6" class="inputfile inputfile-5" />
								<label for="file-6"><figure><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg></figure> <span></span></label>
								<br><input type="button" id="submittestcase" class="btn btn-primary" value="Add testcase"/>
							</div>
						</div>	
					<div id="contesteditproblems" class="col-xs-12 col-md-11  row" style="display:none">
						<input type="button" id="editproblemtbtn" class="btn btn-primary" value="Edit problem"/>					        
					</div>
				</div>					 
			</div>	  
		</div>  
	</div>
</body>

<script>
	
	
	var problemnumber=0;
	var canedit="no";
	var contestid =null;
	var contestname=null;
	var loc = window.location;
	var flagproblemlist=false;
	var flagteamlist=false;
	var userlogin=null;
	var userloginid=null;
	var username=null;
	var problemid=null;
	var teamid=null;
	var contestadmin=null;
	$(document).ready(function () {
		$('#editproblemsubmitbtn').prop('disabled', false);
		$('#addproblemsubmitbtn').prop('disabled', false);
		$("#contents").css('overflow-x', 'scroll');
		$("#contents").niceScroll({ cursorheight: 50,cursorcolor:"#BCBCBC"});
		$(".leftmenu").niceScroll({ cursorheight: 50,cursorcolor:"#BCBCBC"});
		reset();
	
	//get userlogin
		$.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 
            async:false,				
            success: function (data) {
			 userlogin=(JSON.parse(data)).username;
          	userloginid=(JSON.parse(data)).id;	
            },
           error: function (request) { 
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   }                 
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;        	      		
      		}
		
		});
		
//  ///////////////////////////////////
	if(loc.pathname==="/contest/"){
	  contestid = '{{contest_id }}';
	  //alert(contestid);
	 $( '#getidcontest ' ).html(contestid);	
	 setTimeout(function(){
	  $.ajax({
            type: "GET",
            url : "/contest/by_id/"+contestid+"/",
            dataType: "html", 
             async: false,				
            success: function (data) {
				$myData = (JSON.parse(data));
				//alert($myData.ends_on);
				$('#contestinformation').append('<div class="open-page info-contest" ><div class="row header-team"><div class="col-sm-3"><button  id="cancelContestButton" onclick="$cancelContest();" class="hover-button" style="display: none">Cancel</button></div><div class="col-sm-6"><div><p class="editable">' + $myData.name + '</p></div></div><div class="col-sm-3"><button id="editContestButton" onclick="$editContest();" style="display:none"; class="hover-button">Edit</button></div></div><div class="body-team"><div class="sector-block-contest"><div class="title">owner</div><p>' + $myData.owner.username + '</p></div><div class="sector-block-contest"><div class="title">created on</div><p>' + convertUTCDateToLocalDate($myData.created_on )+ '</p></div><div class="sector-block-contest"><div class="title">starts on</div><p>' + convertUTCDateToLocalDate($myData.starts_on) + '</p></div><div class="sector-block-contest"><div class="title">ends on</div><p>' + convertUTCDateToLocalDate($myData.ends_on) + '</p></div></div><input class="contest-id" type="hidden" value="' + $myData.id + '"></div>');
			
					countdown($myData.starts_on,$myData.ends_on);
				
				 contestname=(JSON.parse(data)).name;
				 contestadmin=(JSON.parse(data)).owner.username;
				checkifadmin(contestadmin);
				 changecontestpage(contestname);
				 $('#loading').hide();
				$('#body').show();
				 if($(location).attr('pathname') == "/contest/"+contestname+"/details_page/"){
			//alert("hello");
				$('#rank').css('background-color', '#355C7D');
				reset();
				$("#contestrank").show(1000);
				$("#titlePage").text("Ranking");
				$.ajax({
					type : "GET",
					url : "/contest/" + contestid + "/details/",
					dataType: "html",
					contentType: "application/json",
					success : function(data ){
						var num=(JSON.parse(data)).problem_num;
						var data=(JSON.parse(data)).teams;
						if(data==""){
							$('#contestrank').html("There is no rank list to show");
						}else{
						
						
						var tr;
						tr = '<tr id="0"><td>Rank</td><td>Team name</td><td>Solved problem</td><td>Penalty</td>';
						for(var j=1;j<=num;j++){						
							tr+='<td >Problem '+j+'</td>';
						}
							tr+='</tr>';
						$('#contestranklist').append(tr);
						for (var i = 0; i < data.length; i++) {
								tr = '<tr id="TR'+i+'">';
								tr+='<td>' + (i+1) + '</td>';
								tr+='<td> <a href="#" id="rank'+i+'">' + data[i].team.name + "</a></td>";																
								tr+="<td>" +data[i].solved_problem_counter+ "</td>";
								tr+="<td>" +data[i].penalty+ "</td>";
								var problemtry=data[i].problems_list;
								var trk=[];
								for(var j=1;j<=num;j++){
									trk[j]='<td> </td>';
								}																
									for(var k=0;k<problemtry.length;k++){
										for(var j=1;j<=num;j++){																	
											if(problemtry[k].order==j){
																							
												if(problemtry[k].solved===true){
												trk[j]='<td style="background-color:#88A65E;">Failed tries:  ' +problemtry[k].failed_tries + '</td>';
												}else{
														
												trk[j]='<td style="background-color:#F26C4F;">Failed tries:   ' +problemtry[k].failed_tries + '</td>';
												}
											}
										}
									
									
									}
								tr+=trk;	
								tr+='</tr>';
								$('#contestranklist').append(tr);
								
								
							$('#rank'+i).attr("href",("/team/"+data[i].team.name+"/"))	;
						}
					}
					},
					error : function(request ){
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
						swal("Sorry!", "Contest does not exist!", "error") ; 
					}
			});
	}
				  				
            },
           error: function (request) { 
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   }                 
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;  	      	      		
      		}
		}); 
		}, 0); 	
	//alert($(location).attr('pathname'));
	//alert("/contest/"+contestname+"/details_page/");
	
	}
	
// ////////////////////////////////////////////////////////////////////

	function countdown(stime,etime){	
		var days, hours, minutes, seconds;
		var countdown = document.getElementById("countdown");
		var timeinterval =setInterval(function () {
			var d = moment(new Date());
			var day=moment(convertUTCDateToLocalDate(stime));
			var target_date=0;
			if(d<day){
				 target_date =moment(convertUTCDateToLocalDate(stime));			
			}else if (d>day){				
					target_date =moment(convertUTCDateToLocalDate(etime));				
			}
			var current_date = new Date().getTime();
			var seconds_left = (target_date - current_date) / 1000;
			days = parseInt(seconds_left / 86400);
			seconds_left = seconds_left % 86400;     
			hours = parseInt(seconds_left / 3600);
			seconds_left = seconds_left % 3600;     
			minutes = parseInt(seconds_left / 60);
			seconds = parseInt(seconds_left % 60);
			countdown.innerHTML = days + "d," + hours + "h,"
			+ minutes + "m," + seconds + "s"; 	 
			if(days<=0 && hours<=0 && minutes<=0 && seconds<=0){
				if(d<day){
					countdown.innerHTML = "Start..."; 	
				}else if (d>day){		
					clearInterval(timeinterval);
					countdown.innerHTML = "Finished"; 
				}
			}
		}, 1000);
	}
	function checkifadmin(username){
		 if(username===userlogin){
           document.getElementById('contestteam').style.display = 'block';
           $('#contesteditproblems').show();
           $('#editcontestbtn').show();
           $('#addtestcase').show();
           $('#contestlanguageproblem').hide();
           $('#contesttestcaseexamplediv').hide();
           document.getElementById('joinbtn').style.display = 'none';
           
           $("#editContestButton").show();
           $(".edit-order").show();
			canedit="yes";
			}
           else{
			   $('#addtestcase').hide();
           $('#contestlanguageproblem').show();
           $('#contesttestcaseexamplediv').show();
			   $('#contestquestionsubmit').show(1000);
			
			  document.getElementById('joinbtn').style.display = 'block';
			   
			   }		 
	}
	function changeprofile(username){
			$('#titlePage').text(username+"'s contests");
			document.title = username;
			document.getElementById('backtoprofile').style.display = 'block';
			document.getElementById('logout').style.display = 'none';
			document.getElementById('users').style.display = 'none';
			document.getElementById('setting').style.display = 'none';			
			document.getElementById('createcontestdiv').style.display = 'none';		
					 
}
	function checkprofile(username){
		
		 $.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 				
            success: function (data) {
			 userlogin=(JSON.parse(data)).username;
           if(username===userlogin){
				return true;
         	}
           else{
			  changeprofile(username);
			   return false
			   }				
            },
           error: function (request) {  
			    if(request.status===405){
				   window.location.replace("/user/"); 
			   }              
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
				return false; 	      	      		
      		}
		
		});
	}
	function convertlocaltoUCP(date){
		var d=moment(date);
		var n_date=new Date(date);
		var localOffset = n_date.getTimezoneOffset() * 60000;
		var localTime = n_date.getTime();
        date = localTime + localOffset;
		//alert("localOffset"+localOffset+"localTime");
    return (date);
	}
	function convertUTCDateToLocalDate(date) {
		var d=moment(date);
		var n_date=new Date(d);
		var localOffset = n_date.getTimezoneOffset() * 60000;
		var localTime = n_date.getTime();
        date = localTime - localOffset;
    return (moment(date).format('YYYY-MM-DD HH:mm:ss'));
	}
	function reset(){
	//reset menu
		$('#contestteam').css('background-color', '#1B325F');
		$('#questions').css('background-color', '#1B325F');
		$('#rank').css('background-color', '#1B325F');
	//reset main div
		$("#contestrank").hide();
		$("#contestinformation").hide();
		$("#addproblemdiv").hide();
		$("#contestquestions").hide();
		$("#contestteams").hide();
		$("#contestaddquestions").hide();
		$("#contestquestion").hide();
		$("#createcontestdiv").hide();
		
		$("#problemhead").hide();
		$("#maintitr").show();

	}
	function getidprofile(id){    		   		
	  $.ajax({
				type: "GET",
				url : '/user/'+id+'/teams/',
				dataType: "html", 				
				success: function (data) {
					var data=(JSON.parse(data)).teams;
					
					 var tr;
			for (var i = 0; i < data.length; i++) {
				tr = $('<tr/>');
				tr.append('<td style="display:none">' + data[i].contests.id + "</td>");
				tr.append("<td>" + data[i].contests.name + "</td>");
				tr.append("<td>" + data[i].contests.starts_on + "</td>");
				tr.append("<td>" + data[i].contests.ends_on + "</td>");
				tr.append("<td>" + data[i].name + "</td>");
				$('#contestinfo').append(tr);
			}

				},
			   error: function (request) {
				    if(request.status===405){
				   window.location.replace("/user/"); 
			   }                
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;       	      		
				}
			});
	  } 
	function addRowHandlers() {
		var table = document.getElementById("tableId");
		var rows = table.getElementsByTagName("tr");
		for (i = 0; i < rows.length; i++) {
			var currentRow = table.rows[i];
			var createClickHandler = 
				function(row) 
				{
					return function() { 
											var cell = row.getElementsByTagName("td")[0];
											var id = cell.innerHTML;
											//alert("id:" + id);
									 };
				};

			currentRow.onclick = createClickHandler(currentRow);
		}
	}
	function clearprobleminput(){
		$("#problemtitle").val('');
		$("#problemtimelimit").val('');
		$("#problemspacelimit").val('');
		$("#problemheader").val('');
		$("#problembody").val('');
		$("#problemfooter").val(''); 
		$("#problemtestcaseinput").val('');  
		$("#problemtestcaseoutput").val('');
	}
	function backtocontestpage(){
		window.history.pushState("", "title", "/contest/"+contestname+"/");
		checkifadmin(contestadmin);
		reset();
		$("#backtoproblemlistbtn").hide();
		$(".backtoprofile").show();
		$('#titlePage').html("Details") ;	
		$('#contestinformation').show(1000);
	}
	function changecontestpage(contestname){		
		document.title = contestname;
		$( '#getcontestname ' ).append(contestname);
		$('#contestleftmenu').show();
		$('#contestinformation').show();
		$('#leftmenu').hide();
		$('#contestinfoforusers').hide();
		$('#createcontestdiv').hide();
		document.getElementById('titlePage').innerHTML="Details" ;
		$('#questions').css('background-color', '#1B325F');
		$('#rank').css('background-color', '#1B325F');
		$('#team').css('background-color', '#1B325F');
		$('#backtoprofile').css('background-color', '#1B325F');
		
							
		}
	function getAbsolutePath() {
    
    var pathName = loc.pathname.substring(0, 9);
    return pathName;
}
	function showproblem(){
		$('#contestinfoforusers').hide();
			$('#maintitr').hide();
			$('#problemhead').show();
			$('#contestinformation').hide();
			$('#contestquestions').hide();
			$('#contestquestion').show();
			$('#contestrank').hide();	
			$('#contestaddquestions').hide();
			$('#addproblemdiv').hide();
			/**/
	}
	function loadquestiondiv(id,team){	
		$("#file-6").next('label').find( 'span' ).html(" ");
		 //$("#file-6").value(" ");
		 $("#file-5").next('label').find( 'span' ).html(" ");
		 //$("#file-5").value(" ");
		 showproblem();
	 problemid=(parseInt(id)+1);
	 $('#contestteam').css('background-color', '#1B325F');
	 $('#questions').css('background-color', '#355C7D');
	 //show problem
	 $.ajax({
            type: "GET",
            url :"/contest/"+contestid+"/"+team+"/problems/"+(parseInt(id)+1)+"/",
            dataType: "html",
            beforeSend: function() {
				$('#loading').show();
				$('#body').hide();
			},  				
            success: function (data) {
			document.getElementById('titleproblem').innerHTML=((JSON.parse(data)).title) ;
			//$('#problemhead').css("text-align","center");	
			document.getElementById('orderproblem').innerHTML=((JSON.parse(data)).order);		
			problemid=((JSON.parse(data)).id);
			$("#contestspacelimitdiv").html((JSON.parse(data)).space_limit);
			$("#backtoproblemlistbtn").show();
			$(".backtoprofile").hide();
			$("#contesttimelimitdiv").html((JSON.parse(data)).time_limit );
			$("#contestheaderdiv").html((JSON.parse(data)).header);
			$("#contestbodydiv").html((JSON.parse(data)).body);
			$("#contestfooterdiv").html((JSON.parse(data)).footer);
			//alert((JSON.parse(data)).testcases[0].input);
			if(((JSON.parse(data)).testcases)!=""){		
				$("#contesttestcaseexamplediv").show();
				$("#testcaseinput").html(((JSON.parse(data)).testcases[0]).input);
				$("#testcaseoutput").html(((JSON.parse(data)).testcases[0]).output);
			}
			else{
				$("#contesttestcaseexamplediv").hide();				
			}
			$("#idproblem").html((JSON.parse(data)).id);												
            },
          error: function (request, status, error) {
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   } 			    
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;  			         
           },
           complete: function(){
					$('#loading').hide();
					$('#body').show();
				}   
    });
   
if(canedit==="no"){
		$.ajax({
				type: "GET",
				url :"/user/"+userloginid+"/contest/"+contestid+"/",
				dataType: "html",
				contentType: "application/json",		 				
				success: function (data) {
					showproblem();
					 problemid=(parseInt(id)+1);
					 $('#contestteam').css('background-color', '#1B325F');
					 $('#questions').css('background-color', '#355C7D');
					 teamid=((JSON.parse(data)).id);
					 $("#idteam").html((JSON.parse(data)).id);
					$( '#file-5' ).each( function(){
							var $input	 = $( this ),
							$label	 = $input.next( 'label' ),
							labelVal = $label.html();
							$input.on( 'change', function( e ){
							var fileName = '';
							fileName = e.target.value.split( '\\' ).pop();
							if( fileName )
								$label.find( 'span' ).html( fileName );
							else
								$label.html( labelVal );
						});

						// Firefox bug fix
						$input
						.on( 'focus', function(){ $input.addClass( 'has-focus' ); })
						.on( 'blur', function(){ $input.removeClass( 'has-focus' ); });
					});
					 $("#submitcode").click(function() {
						 alert("hello");
						 var filetype= $('.nav-pills > li.active a').attr("id");
						 var file1 = $("#file-5")[0].files[0];
						 //alert("/contest/submit/"+contestid+"//"+(parseInt(id)+1)+"//");
						 $.ajax({
							type: "POST",
							url : "/contest/submit/"+contestid+"/"+teamid+"/"+(parseInt(id)+1)+"/"+filetype+"/",
							contentType: false,
							processData: false,
							dataType: "html",			
							data:file1,
							beforeSend: function() {
								$('#submitloading').show();
							},
							success: function (data) {
								if((JSON.parse(data)).status !="Accepted"){
										swal("OoOops!!!", "You have:"+(JSON.parse(data)).status, "error");	 	
								}else{
										swal("Accepted!","Your answer submited successfully", "success");
								}				  
							},
							error: function (request, status, error) {
								swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
							},
							complete: function(){
									$('#submitloading').hide();
									$("#file-5").next('label').find( 'span' ).html(" ");
									$("#file-5").value(" ");
							}
						});		
					});
				},
				 error: function (request, status, error) { 
					if(request.status===405)
						window.location.replace("/user/");   			  
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
					}												
		

		});

  }
  else{  

	  showproblem();
	 problemid=(parseInt(id)+1);
	 $('#contestteam').css('background-color', '#1B325F');
	 $('#questions').css('background-color', '#355C7D');
	 
	 $( '#file-6' ).each( function(){
			var $input	 = $( this ),
			$label	 = $input.next( 'label' ),
			labelVal = $label.html();
			$input.on( 'change', function( e ){
			var fileName = '';
			fileName = e.target.value.split( '\\' ).pop();
			if( fileName )
				$label.find( 'span' ).html( fileName );
			else
				$label.html( labelVal );
		});

		// Firefox bug fix
		$input
		.on( 'focus', function(){ $input.addClass( 'has-focus' ); })
		.on( 'blur', function(){ $input.removeClass( 'has-focus' ); });
	});
	$("#submittestcase").click(function() {
				var file = $("#file-6")[0].files[0];
				   $.ajax({
					type: "POST",
					url : "/contest/" + contestid + "/testcase/" +problemid + "/",
				   contentType: false,
				   processData: false,
					dataType: "html",			
					data:file,
					beforeSend: function() {
						
							$('#testcaseloading').show();
						},
					success: function (data) {
						swal("Good!", " testcase added successfully", "success");
						  
					},
					error: function (request, status, error) {
						 if(request.status===405){
						   window.location.replace("/user/"); 
					   }
						swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
					},
					 complete: function(){
							$('#testcaseloading').hide();
							$("#file-6").next('label').find( 'span' ).html(" ");
							$("#file-6").value(" ");
						}
					  });

			});

	
}


}
	function acceptorrejectteam(id,flag){
		
		 $.ajax({
	  
            type: "PUT",
            url : "/contest/"+contestid+"/team_acceptation/"+id+"/",
            contentType: "application/json",
            dataType: "html",			
            data: '{ "acceptation":"'+flag+'"}',
            beforeSend: function() {
					$('#acceptorrrejectloading').show();
					 $('.rejectteam').prop('disabled', true);
					   $('.acceptteam').prop('disabled',true);
				},
            success: function (data) {
				swal({
					  title: "Good!",
					  text: "Your changes submited successfully",
					  type: "success",
					 
					  closeOnConfirm: true,
					  //showLoaderOnConfirm: true,
					},
					function(){
					  
						window.location.replace("/contest/"+contestname+"/");
					});    
             
              
            },
            error: function (request, status, error) {
				 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
				
            },
            complete: function(){
					   $('.rejectteam').prop('disabled', false);
					   $('.acceptteam').prop('disabled', false);
					$('#acceptorrrejectloading').hide();
				}
              });
	

}	
	function getproblem(team){
		  $.ajax({
				type: "GET",
				url :"/contest/"+contestid+"/"+team+"/problems/",
				dataType: "html",
			   beforeSend: function() {
					$('#loading').show();
					$('#body').hide();
				},
				success: function (data) {
					
				reset();//added by milad
				document.getElementById('titlePage').innerHTML="Problems" ;
				$('#contestquestions').show();				
				 $('#questions').css('background-color', '#355C7D');
				 if (canedit==="yes"){
					 document.getElementById('addproblemdiv').style.display = 'block';
				 }
				var data=(JSON.parse(data)).problems;
					 var tr;
					 problemnumber=data.length;
					 if(flagproblemlist==false){
				for (var i = 0; i < data.length; i++) {
					li = $('<li id="Q'+i+'">');

					li.append('<input type="hidden" value="' + data[i].id + '" />');
					li.append('<div class="subset-question order">' + data[i].order + '</div>');
					li.append('<div class="subset-question title">' + data[i].title + '</div>');
					li.append('<div class="subset-question title"><button id="'+i +'" class="hover-button viewproblem">Show</button></div>');
					//tr.append("<td>" + data[i].name + "</td>");
					$('.sortable').append(li);
				}
					$('.viewproblem').click(function(){
						
						id = $(this).attr('id');
						loadquestiondiv(id,team);
					});
					flagproblemlist=true;
					}
				},
					
					error: function (request, status,error) {
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
				  swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
			   },
			    complete: function(){
					$('#loading').hide();
					$('#body').show();
				}
		});
	}
	$("#questions").click(function() {
	window.history.pushState("", "title", "/contest/"+contestname+"/");
	
	$.ajax({
            type: "GET",
            url :"/user/"+userloginid+"/contest/"+contestid+"/",
            dataType: "html",
            contentType: "application/json",		 				
            success: function (data) {
			getproblem((JSON.parse(data)).id);
			
	
		},
		error: function (request, status,error) {
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
			   
		 $.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 
            async:false,				
            success: function (data) {
			userlogin=(JSON.parse(data)).username;
			if(contestadmin==userlogin){
				getproblem("admin");
			}else{
				swal("Sorry!","You can't see problems", "error");
			}
            },
           error: function (request) { 
				   window.location.replace("/user/"); 
	       	      		
      		}
		
		});
				  
			   }
	});
	 });	 
	 $("#editproblemtbtn").click(function() {
		$('#maintitr').show();
		reset();
		 document.getElementById('problemhead').style.display = 'none';
		document.getElementById('titlePage').innerHTML="Edit Problems" ;
		document.getElementById('addproblemsubmitbtn').style.display = 'none';
		document.getElementById('editproblemsubmitbtn').style.display = 'block';
		$('#contestaddquestions').show();
		 $('#contestteam').css('background-color', '#1B325F');
		 $('#questions').css('background-color', '#355C7D');		
				//$("#contesttestcaseexamplediv").val();
		 $("#problemtitle").val($("#titleproblem").text());
		 $("#problemtimelimit").val($("#contesttimelimitdiv").text());
		 $("#problemspacelimit").val($("#contestspacelimitdiv").text());
		 $("#problemheader").val($("#contestheaderdiv").text());
		 $("#problembody").val($("#contestbodydiv").text());
		 $("#problemfooter").val($("#contestfooterdiv").text()); 
		 $("#problemtestcaseinput").val($("#testcaseinput").text());  
		 $("#problemtestcaseoutput").val($("#testcaseoutput").text()); 			
			 
	 });
	 $("#editproblemsubmitbtn").click(function() {
		var problemtitle = $("#problemtitle").val();
		var problemtimelimit = $("#problemtimelimit").val();
		var problemspacelimit = $("#problemspacelimit").val();
		var problemheader = $("#problemheader").val();
		var problembody = $("#problembody").val();
		var problemfooter = $("#problemfooter").val(); 
		var problemtestcaseinput = $("#problemtestcaseinput").val();  
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();
		//var problemid=$("#idproblem").val();
		var datawotestcase={"problems": [{ "id":problemid ,"title":  problemtitle , "time_limit" : problemtimelimit , "space_limit" : problemspacelimit , "header" : problemheader, "body" :  problembody , "footer" : problemfooter }]};
		var datawtestcase={"problems": [{"id":problemid,"title": problemtitle , "time_limit" : problemtimelimit , "space_limit" :  problemspacelimit , "header" :  problemheader, "body" : problembody , "footer" :  problemfooter ,"testcases": [ {"id":"1" ,"order":"1" , "input":problemtestcaseinput ,"output":problemtestcaseoutput } ]}]};
		if(problemtestcaseinput=="" && problemtestcaseoutput==""){
			var obj = datawotestcase;
		}
		else{	
			var obj = datawtestcase;

		}

	  $.ajax({
		  
				type: "PUT",
				url : "/contest/"+contestid+"/",
			   contentType: "application/json",
				dataType: "html",			
				data:JSON.stringify(obj),
				 beforeSend: function() {
					$('#addproblemloading').show();
					 $('#editproblemsubmitbtn').prop('disabled', true);
				},
				success: function (data) {
					swal("Good!"," problem edited successfully", "success") ; 
					clearprobleminput();
					backtocontestpage();
				},
				error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
					
				},
				  complete: function(){
					   $('#editproblemsubmitbtn').prop('disabled', false);
					$('#addproblemloading').hide();
				}
				  });
	  
	 });
	$("#logout").click(function() { 
		
	  $.ajax({
				type: "GET",
				url : '/user/logout/',
				dataType: "html",  				
				success: function () {
				window.location.replace("/user/");
				},
			  error: function (request, status, error) { 
				  window.location.replace("/user/");           
				}
				
		});
	  });
	$(".backtoprofile").click(function() { 
		 $.ajax({
				type: "GET",
				url : '/user/get_profile/',
				dataType: "html", 				
				success: function (data) {
					var userlogin=(JSON.parse(data)).username; 
					
					window.location.replace("/user/"+userlogin+"/");         				
				},
			   error: function (request) {                
					window.location.replace("/user/");  	      	      		
				}
			});
			});
	$("#addproblembtn").click(function() { 
	clearprobleminput(); 
	reset();
		document.getElementById('titlePage').innerHTML="Add Problems" ;
		$('#contestaddquestions').show(1000);
		document.getElementById('addproblemsubmitbtn').style.display = 'block';
		document.getElementById('editproblemsubmitbtn').style.display = 'none';
		 $('#contestteam').css('background-color', '#1B325F');
		 $('#questions').css('background-color', '#355C7D');
	});
	$("#addproblemsubmitbtn").click(function() { 		
		var problemtitle = $("#problemtitle").val();
		var problemtimelimit = $("#problemtimelimit").val();
		var problemspacelimit = $("#problemspacelimit").val();
		var problemheader = $("#problemheader").val();
		var problembody = $("#problembody").val();
		var problemfooter = $("#problemfooter").val(); 
		var problemtestcaseinput = $("#problemtestcaseinput").val();  
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();  
		var problemtestcaseinput = $("#problemtestcaseinput").val();
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();
		var datawotestcase={"title": problemtitle, "time_limit" :  problemtimelimit , "space_limit" :  problemspacelimit , "header" : problemheader , "body" :  problembody , "footer" :  problemfooter };
		var datawtestcase={"title": problemtitle , "time_limit" :  problemtimelimit , "space_limit" :  problemspacelimit , "header" :problemheader , "body" :  problembody , "footer" :  problemfooter ,"testcases": [ { "input":problemtestcaseinput ,"output":problemtestcaseoutput } ]};
		 var obj={};
		if(problemtestcaseinput=="" && problemtestcaseoutput==""){
			
			 obj = datawotestcase;

		}
		else{	
			obj = datawtestcase;
		}
			
		$.ajax({
				type: "POST",
				url : "/contest/"+contestid+"/problem/",
			   contentType: "application/json",
				dataType: "html",			
				data: JSON.stringify(obj),
				 beforeSend: function() {
					 $('#addproblemsubmitbtn').prop('disabled',true);
					$('#addproblemloading').show();
				},
				success: function (data) {
					swal({
						  title: "Good!",
						  text: "problem added successfully",
						  type: "success",
						 
						  closeOnConfirm: false,
						  showLoaderOnConfirm: true,
						},
						function(){
						clearprobleminput(); 
					window.location.replace("/contest/"+contestname+"/");
						});    
				 
					 
				},
				error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
				
				  
				},
				complete: function(){
					   $('#addproblemsubmitbtn').prop('disabled', false);
					$('#addproblemloading').hide();
				}
		 });
	});	
	$("#cancleproblemsubmitbtn").click(function() { 
		clearprobleminput();
		 backtocontestpage();
	});	
	$("#getusername").click(function() {
				window.location.replace("/user/"+username+"/");
			});	
	$("#backtoproblemlistbtn").click(function() {			
		 $("#backtoproblemlistbtn").hide();
		 $(".backtoprofile").show();
		 $('#questions').click();
		 
	});	
	$("#contestteam").click(function() { 
		
		
	});	
	$("#rank").click(function( ){
			window.history.pushState("SADASD", "title", "/contest/"+contestname+"/details_page/");			
		});		
		
	$('#contestnameitem').click(function( ){
		backtocontestpage(); 
	});
	

</script>
</html>
