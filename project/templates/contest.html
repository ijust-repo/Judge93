<html  lang="en">
<head>
	<link href="{{ url_for('static', filename='../statics/css/font-awesome.min.css') }} "rel="stylesheet" />
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Contests</title>
	<link  href="{{ url_for('static', filename='../statics/img/jicon.png') }} " rel="icon" >
    <link href="{{ url_for('static', filename='../statics/css/bootstrap.css') }} " rel="stylesheet" />
    <link href="{{ url_for('static', filename='../statics/css/sweetalert.css') }} " rel="stylesheet" />     
    <link href="{{ url_for('static', filename='../statics/css/bootstrap-datetimepicker.min.css') }} " rel="stylesheet" />  
    <link href="{{ url_for('static', filename='../statics/css/style.css') }}" rel="stylesheet" />   
    <link href="{{ url_for('static', filename='../statics/css/fileinput.min.css') }}" rel="stylesheet" />
    <script src="{{ url_for('static', filename='../statics/js/jquery-2.1.3.js') }}" /></script>
    <script src="{{ url_for('static', filename='../statics/js/jquery.nicescroll.min.js') }}" /></script>
    <script src="{{ url_for('static', filename='../statics/js/bootstrap.js') }}" /></script>
    <script src="{{ url_for('static', filename='../statics/js/fileinput.min.js') }}" /></script>
    <script src="{{ url_for('static', filename='../statics/js/sweetalert.min.js') }}" /></script>   	
	<script src="{{ url_for('static', filename='../statics/js/moment.min.js') }}" /></script>
	<script src="{{ url_for('static', filename='../statics/js/bootstrap-datetimepicker.min.js') }}" /></script>	    
	

</head>
 


<body>
	<div id="loading" style="text-align:center;position:relative;top:40%"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i> <p>Please wait...</p></div>
<div id="body" style="display:none">
	<ul class=" col-xs-3 col-md-2 leftmenu shadow " id="leftmenu" >
		
		<li class=" usernameitem " id="usernameitem">
			<a href="#"><h4 id="getusername" class="leftmenuitem"><img src="{{ url_for('static', filename='../statics/img/j2.png') }}" height="100%"/>  </h4></a>
			<a ><h4 id="getidprof" class="leftmenuitem" style="display:none"></h4></a>
		</li>			
		<li  id="contest"  >
			
		 	<a href="#" ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Contests</h4></a>
		</li>
		
		<li  id="team"  >
		 	<a href="#"><h4 class="leftmenuitem"><i class="fa fa-group" style=" width:20px; height:20px; "></i> Teams</h4></a>
		</li>
		
		<li  id="users"  style="display:none" >
		 	<a href="#users"><h4 class="leftmenuitem"><i class="fa fa-user" style="width:20px; height:20px; "></i> Users</h4></a>
		</li>
		
		<li  id="setting"  >
		 	<a href="/user/setting/"><h4 class="leftmenuitem"><i class="fa fa-gears" style=" width:20px; height:20px; "></i> Settings</h4></a>
		</li>
		
		<li  id="logout"   >
		 	<a href="#logout"><h4 class="leftmenuitem"><i class="fa fa-sign-out" style=" width:20px; height:20px; "></i> Log out</h4></a>
		</li>
		<li  id="backtoprofile" class="backtoprofile" style="display:none" >
		 	<a href="#"><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i>Back to profile</h4></a>
		</li>

	</ul>
	<ul class=" col-xs-3 col-md-2 leftmenu shadow " id="contestleftmenu" style="display:none">
		
		<li class=" usernameitem " id="contestnameitem">
			<a href="" ><h4 id="getcontestname" class="leftmenuitem">
				<img src="{{ url_for('static', filename='../statics/img/j2.png') }}" height="100%"/></h4> 
			</a>
				  
			<h4 id="getidcontest" style="display:none"></h4>
		</li>			
		<li  id="questions" class=" usernameitem " >
			
		 	<a href="#questions" ><h4 class="leftmenuitem"><i  class="fa fa-code" style="width:20px; height:20px;"> </i> Problems</h4></a>
		</li>		
		<li  id="rank" >
			
		 	<a href=""><h4 class="leftmenuitem"><i  class="fa fa-area-chart" style="width:20px; height:20px;"> </i> Rank list</h4></a>
		</li>		
		<li  id="contestteam"  style="display:none">
		 	<a href="#teams"><h4 class="leftmenuitem"><i class="fa fa-group" style=" width:20px; height:20px; "></i> Teams</h4></a>
		</li>
		<li  id="time"  >
		 	<h4 class="leftmenuitem"><i class="fa fa-clock-o" style=" width:20px; height:20px; "></i> <span id="countdown" class="countdown"></span></h4>
		</li>		
		<li  id="backtoprofile" class="backtoprofile" >
		 	<a href="#back" ><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i> Back to profile</h4></a>
		</li>

	</ul>

	<div id="createContest" class="form-dialog">
        <div>
            <a href="#" title="Close" class="close-button">X</a>
            <form>
                <div class="question">
                    <input type="text" id="contest_name" required/>
                    <label>Contest Name</label>
                </div>
                <label style="margin-top:10px;">starts</label>
                <div class='input-group date' id='contest_start'>
                    <input type='text' class="form-control" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
		        <script type="text/javascript">
		            $(function () {
		                $('#contest_start').datetimepicker();
		            });
		        </script>
                <!--
                <input type="date" required id="contest_start_date" style="width:100%;margin-top:-8px;" />
                <input type="time" required id="contest_start_time" style="width:100%;margin-top:2px;" />
                
                <input type="datetime-local" required id="contest_start" style="width:100%;margin-top:-8px;" />
                -->
                <label style="margin-top:10px;">ends</label>
                <div class='input-group date' id='contest_end'>
                    <input type='text' class="form-control" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
		        <script type="text/javascript">
		            $(function () {
		                $('#contest_end').datetimepicker();
		            });
		        </script>
                <!--
                <input type="date" required id="contest_end_date" style="width:100%;margin-top:-8px;" />
                <input type="time" required id="contest_end_time" style="width:100%;margin-top:2px;" />
                
                <input type="datetime-local" required id="contest_end" style="width:100%;margin-top:-8px;" />
                -->
                <button id="create_contest_button" type="submit" class="submit-button">Submit</button>
            </form>
        </div>
    </div>
    
<div class="col-xs-offset-3 col-md-offset-2 row">
	<div id="maintitr" class="col-xs-9 col-md-10 maintitr">
		<p id="titlePage">Your contests</p>
		<div id="createcontestdiv" ><a href="#createContest"><button class="hover-button close-page">Create  Contest</button></a></div>
		<div id="addproblemdiv" style="display:none"><a href="#addProblem"><button id="addproblembtn" class="hover-button close-page">Add problem</button></a></div>
	</div>
	<div id="problemhead" class="col-xs-9 col-md-10 maintitr" style="display:none ; ">
		<input type="button" id="backtoproblemlistbtn" class="hover-button " value="Back to contest"/>
		
		<p id="orderproblem" class="contestproblem " ></p>
		<p id="titleproblem" class="contestproblem "></p>
		<p id="idproblem" class="contestproblem " style="display:none"></p>
		<p id="idteam" class="contestproblem " style="display:none"></p>
		
	</div>
</div>
   
<div class="col-xs-offset-3 col-md-offset-2 row">
      	<div id="contents" class="contents  " >
			<div id="contestinfoforusers"class="CSSTableGenerator" style="display:none">					
				<table id="contestinfo">
				   <tr>
					   <td style="display:none"> id </td>
					   <td > Name </td>
					   <td > Sart on </td>
					   <td> End on </td>
					   <td >Team</td>				     
					</tr>
				</table>
			</div>
            <div id="contestinformation" class="CSSTableGenerator" style="display:none">
				<button  id="joinbtn"  class="hover-button" style="display: none">Join</button>
				</div>            
            <div id="contestquestions" class="CSSTableGenerator" style="display:none">
				
				<div class="edit-order" style="display:none">
					<button class="hover-button" >Edit Order</button>
				</div>
				<ul >
					<li>
						<div class="subset-question">Order</div>
						<div class="subset-question">Title</div>

					</li>
				</ul>
				<ul class="sortable"></ul>
			</div>
			<div id="contestaddquestions" style="display:none; margin:3%;">
				Problem details:
				<hr>
				<label class="labelcss" for="problemtitle">Title: </label>
				<input type="text" name="problemtitle" id="problemtitle" style="width:85%"/><br><br>
				<div class="row"> 
					<label class="labelcss" for="problemtimelimit">Time limit(ms): </label>
					<input type="text" name="problemtimelimit" id="problemtimelimit" style="margin-right:3%; width:35.5%"/>
					<label class="labelcss" for="problemspacelimit">Space limit(kb): </label>
					<input type="text" name="problemspacelimit" id="problemspacelimit" style="width:35.5%"/><br>
				</div>
				<label class="labelcss" for="problemheader">Header: </label>
				<textarea class="textareacss" name="problemheader"  id="problemheader"></textarea><br>
				<label class="labelcss" for="problembody">Body: </label>
				<textarea class="textareacss" name="problembody" id="problembody" ></textarea><br>
				<label class="labelcss" for="problembody">Footer: </label>
				<textarea class="textareacss" name="problemfooter" id="problemfooter" ></textarea><br>
				<hr>
				sample Testcase:<br>
				
				<div class="testcase" id="problemtestcase" >
					<hr>
					<label class="labelcss" for="problemtestcaseinput">Input: </label>
					<textarea class="textareacss" name="problemtestcaseinput" id="problemtestcaseinput" ></textarea><br>
					<label class="labelcss" for="problemtestcaseoutput">Output: </label>
					<textarea class="textareacss" name="problemtestcaseoutput" id="problemtestcaseoutput" ></textarea><br>
				</div>
				<hr>
				<div>
					<button type="submit" id="cancleproblemsubmitbtn" class="btn btn-primary" style="width:15.5%"> Cancle</button>
					<button type="submit"id="addproblemsubmitbtn"  class="btn btn-primary" style="width:15.5%"> Add</button>
									
					<button type="submit" id="editproblemsubmitbtn" class="btn btn-primary" style="width:15.5%"> Submit edit</button>
				</div>
				<div id="addproblemloading" style="display:none">Please wait...</div>
			</div>
			<div id="contestquestion"  style="display:none">
				<div id="contentproblem" class="col-xs-12 col-md-11  contestproblem row">
					<div class="row">
					
					<div class="col-lg-6"><span id="contestspacelimitdiv" ></span><span>:(kb)</span><span>محدودیت حافظه</span>
					
					</div>
					<div class="col-lg-6"><span id="contesttimelimitdiv" ></span><span>:(ms)</span><span>محدودیت زمانی</span>
					
					</div>
					</div><hr>
					<div id="contestheaderdiv" class="row  "></div><hr>
					<div id="contestbodydiv" class="row"></div><hr>
					<div id="contestfooterdiv" class="row"></div><hr>
					<div class="row" id="contesttestcaseexamplediv" >
						<hr>
						<label class="labelcss" for="problemtestcaseinput">Input: </label>
						<textarea class="textareacss" name="problemtestcaseinput" id="testcaseinput" ></textarea><br>
						<label class="labelcss" for="problemtestcaseoutput">Output: </label>
						<textarea class="textareacss" name="problemtestcaseoutput" id="testcaseoutput" ></textarea><br>
					</div>
					<div id="contestlanguageproblem"  class="row">
						
					 <ul class="nav nav-pills">
						 
						  <li class="active" data-toggle="pill" ><a id="cpp" href="#">C++</a></li>
						  <li  data-toggle="pill" ><a id="py" href="#">PYTHON</a></li>
						  <li  data-toggle="pill"><a id="java" href="#">JAVA</a></li>
						</ul>
						
					</div>											
				</div>
				<hr>


				<div id="contestquestionsubmit" class="col-xs-12 col-md-11  row" style="display:none">
					
					<input id="input-2" name="input2[]"  type="file" class="file-loading inputs">	        
				</div>

				<div id="addtestcase" class="col-xs-12 col-md-11  row" style="display:none">
						<p style="text-align:left;">Add testcase file for this problem. Please upload your ZIP file </p>
					<input id="input-1" name="input1[]" type="file"  class="file-loading inputs">	
				
					</div>	
				<div id="contesteditproblems" class="col-xs-12 col-md-11  row" style="display:none">
					<input type="button" id="editproblemtbtn" class="btn btn-primary" value="Edit problem"/>					        
				</div>
			</div>
			<div id="contestrank" class="CSSTableGenerator" style="display:none">
				<table id="contestranklist">
                  
                </table>
				</div>
			<div id="contestteams" class="CSSTableGenerator" style="display:none">
				<div id="acceptorrejectloading" style="display:none">Please wait...</div>
				<table id="contestteamstbl">
					<tr>						  
						<td > Team name </td>
						
						<td > Members </td>
						<td > Admin </td>
						<td> Accept or Reject </td>	
					</tr>
				</table>
			</div>						 
	    </div>	  
   	</div>  
</div>
</body>

<script>
	
	
	var problemnumber=0;
	var canedit="no";
	var contestid =null;
	var contestname=null;
	var loc = window.location;
	var flagproblemlist=false;
	var flagteamlist=false;
	var userlogin=null;
	var userloginid=null;
	var username=null;
	var problemid=null;
	var teamid=null;
	var contestadmin=null;
	$(document).ready(function () {
		$('#editproblemsubmitbtn').prop('disabled', false);
		$('#addproblemsubmitbtn').prop('disabled', false);
		$("#contents").css('overflow-x', 'scroll');
		$("#contents").niceScroll({ cursorheight: 50,cursorcolor:"#BCBCBC"});
		$(".leftmenu").niceScroll({ cursorheight: 50,cursorcolor:"#BCBCBC"});
		reset();
	
	//get userlogin
		$.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 
            async:false,				
            success: function (data) {
			 userlogin=(JSON.parse(data)).username;
          	userloginid=(JSON.parse(data)).id;	
            },
           error: function (request) { 
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   }                 
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;        	      		
      		}
		
		});
		
//  ///////////////////////////////////
	if(getAbsolutePath()==="/contest/"){
	  contestid = '{{contest_id }}';
	  //alert(contestid);
	 $( '#getidcontest ' ).html(contestid);	
	  $.ajax({
            type: "GET",
            url : "/contest/by_id/"+contestid+"/",
            dataType: "html", 
             async: false,				
            success: function (data) {
				$myData = (JSON.parse(data));
				//alert($myData.ends_on);
				$('#contestinformation').append('<div class="open-page info-contest" ><div class="row header-team"><div class="col-sm-3"><button  id="cancelContestButton" onclick="$cancelContest();" class="hover-button" style="display: none">Cancel</button></div><div class="col-sm-6"><div><p class="editable">' + $myData.name + '</p></div></div><div class="col-sm-3"><button id="editContestButton" onclick="$editContest();" style="display:none"; class="hover-button">Edit</button></div></div><div class="body-team"><div class="sector-block-contest"><div class="title">owner</div><p>' + $myData.owner.username + '</p></div><div class="sector-block-contest"><div class="title">created on</div><p>' + convertUTCDateToLocalDate($myData.created_on )+ '</p></div><div class="sector-block-contest"><div class="title">starts on</div><p>' + convertUTCDateToLocalDate($myData.starts_on) + '</p></div><div class="sector-block-contest"><div class="title">ends on</div><p>' + convertUTCDateToLocalDate($myData.ends_on) + '</p></div></div><input class="contest-id" type="hidden" value="' + $myData.id + '"></div>');
				 countdown($myData.ends_on);
				 contestname=(JSON.parse(data)).name;
				 contestadmin=(JSON.parse(data)).owner.username;
				checkifadmin(contestadmin);
				 changecontestpage(contestname);
				  				
            },
           error: function (request) { 
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   }                 
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;  	      	      		
      		}
		}); 
		 	
	}
	else{
		//$("#titlePage").text("Your contests");
		$('#createcontestdiv').show();
		$('#contestinfoforusers').show();
		var id = '{{user_id }}'; 
		
		 $.ajax({
            type: "GET",
            url : "/user/get_profile/by_id/"+id+"/",
            dataType: "html",
            contentType: "application/json", 				
            success: function (data) {
		        username=(JSON.parse(data)).username;
				checkprofile(username);
				$( '#getusername ' ).append(username);
			
				$( '#getidprof ' ).html(id);	
            },
           error: function (request) { 
			    swal("Sorry!", (JSON.parse(request.responseText)).errors, "error"); 
			     if(request.status===405){
				   window.location.replace("/user/"); 
			   }                    	      		
      		}
		});
		 $.ajax({
            type: "GET",
            url : "/user/"+id+"/teams/",
            dataType: "html", 				
            success: function (data) {	
						
		        var data=(JSON.parse(data)).teams;
		        if(data==""){
					$('#contestinfo').html("You are not in any contest right now, please create a team and join to contests!");
				}
		        for (var i = 0; i < data.length; i++) {
					var teamname=data[i].name;
					var teamitem=data[i].contests;	
					for (var j = 0;j < teamitem.length; j++) {				
						tr = $('<tr id="Q'+i+'">');		
						tr.append('<td  style="display:none">' + data[i].id + "</td>");
						tr.append('<td> <a href="#"  id="'+teamitem[j].name+'">' + teamitem[j].name + "</a></td>");
						tr.append("<td>" +convertUTCDateToLocalDate(teamitem[j].starts_on) + "</td>");
						tr.append("<td>" + convertUTCDateToLocalDate(teamitem[j].ends_on) + "</td>");
						tr.append('<td><a href="#" id="'+teamname+'">' + teamname + '</a></td></tr>');
						$('#contestinfo').append(tr);
					$(("#" + teamname)).attr("href",("/team/"+teamname+"/"));
					$(("#" + teamitem[j].name)).attr("href",("/contest/"+teamitem[j].name+"/"));
					}
					
				}
            },
           error: function (request) { 
			    if(request.status===405){
				   window.location.replace("/user/"); 
			   }
			    swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");                     	      		
      		}
		});
 
 $('#contest').css('background-color', '#355C7D');
 }
// ////////////////////////////////////////////////////////////////////
	$('.edit-order').click(function(){

		if ($(this).find('button').html() == 'Edit Order')
		{
					//alert("in click");
			$( ".sortable" ).sortable();
			$( ".sortable" ).disableSelection();
			$(this).find('button').html('Submit');
		}
		else
		{
			var myInfoList = [];
			var counter = 1;
			$('.sortable').find('li').each(function(){
				myInfoList.push(JSON.stringify({"id": parseInt($(this).find('input').val()), "order": counter, "title": $(this).find('div.title').text()}));
				counter += 1;
			});
			$.ajax({
				type: "PUT",
				url : '/contest/' + '{{contest_id}}' + '/',
				contentType: "application/json",
				dataType: "html",
				data: JSON.stringify({"problems" : myInfoList}),
				success: function (data) {
					swal({
								title: "Good!",
								text: "Order successfully Edited",
								type: "success",
								showCancelButton: true,
								closeOnConfirm: false,
								showLoaderOnConfirm: true,
							},
							function(){
								location.reload();
							});
				},
				error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
				}
			});
		}
	});
		$('.close-page').removeClass('close-page').addClass('open-page');
		$('#create_contest_button').click(function() {
			var name = $("input#contest_name").val();
			var c_s = $("#contest_start").find("input").val();
			var c_e = $("#contest_end").find("input").val();
			var start_date = new Date(c_s);
			var end_date = new Date(c_e);
			
			function convertDateToUTC(date) { return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()); }

			start_date = convertDateToUTC(start_date);
			var startMillis = start_date.getTime()/1000;
			
			end_date = convertDateToUTC(end_date);
			var endMillis = end_date.getTime()/1000;
			
			$.ajax({
          		type: "POST",
          		url : '/contest/',
          		contentType: "application/json",
          		dataType: "html",
          		data: '{"name" : "' + name + '", "starts_on" : "' + startMillis + '", "ends_on" : "' + endMillis + '"}',
          		success: function (data) {
					swal({
					  title: "Good!",
					  text: "Contest successfully Created",
					  type: "success",
					 
					  closeOnConfirm: false,
					  showLoaderOnConfirm: true,
					},
					function(){
					 window.location.replace("/contest/" + name + "/");
					});             		
          		},
          		error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error"); 	
          		}
        	});			
		});

		if($(location).attr('pathname') == "/contest/"+contestname+"/details_page/"){
				$('#rank').css('background-color', '#355C7D');
				reset();
				$("#contestrank").show(1000);
				$("#titlePage").text("Ranking");
				$.ajax({
					type : "GET",
					url : "/contest/" + contestid + "/details/",
					dataType: "html",
					contentType: "application/json",
					success : function(data ){
						//alert(data);
						var num=(JSON.parse(data)).problem_num;
						var data=(JSON.parse(data)).teams;
						var tr;
						tr = '<tr id="0"><td>Rank</td><td>Team name</td><td>Solved problem</td><td>Penalty</td>';
						for(var j=1;j<=num;j++){						
							tr+='<td >Problem '+j+'</td>';
						}
							tr+='</tr>';
						$('#contestranklist').append(tr);
						for (var i = 0; i < data.length; i++) {
								tr = '<tr id="TR'+i+'">';
								tr+='<td>' + (i+1) + '</td>';
								tr+='<td> <a href="#"  id="'+data[i].team.name+'">' + data[i].team.name + "</a></td>";																
								tr+="<td>" +data[i].solved_problem_counter+ "</td>";
								tr+="<td>" +data[i].penalty+ "</td>";
								var problemtry=data[i].problems_list;
								var trk=[];
								for(var j=1;j<=num;j++){
									trk[j]='<td> </td>';
								}																
									for(var k=0;k<problemtry.length;k++){
										for(var j=1;j<=num;j++){																	
											if(problemtry[k].order==j){
																							
												if(problemtry[k].solved===true){
												trk[j]='<td style="background-color:#88A65E;">Failed tries:  ' +problemtry[k].failed_tries + '</td>';
												}else{
														
												trk[j]='<td style="background-color:#F26C4F;">Failed tries:   ' +problemtry[k].failed_tries + '</td>';
												}
											}
										}
									
									
									}
								tr+=trk;	
								tr+='</tr>';
								$('#contestranklist').append(tr);
								
								
							$(("#" +data[i].team.name)).attr("href",("/team/"+data[i].team.name+"/"));
						}
					},
					error : function(request ){
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
						swal("Sorry!", "Contest does not exist!", "error") ; 
					}
			});
	}
	$('#loading').hide();
	$('#body').show();
	});
	function countdown(time){
		var target_date =moment(convertUTCDateToLocalDate(time));
		var days, hours, minutes, seconds;
		var countdown = document.getElementById("countdown");
		var myVar =setInterval(function () {
			var current_date = new Date().getTime();
			var seconds_left = (target_date - current_date) / 1000;
			days = parseInt(seconds_left / 86400);
			seconds_left = seconds_left % 86400;     
			hours = parseInt(seconds_left / 3600);
			seconds_left = seconds_left % 3600;     
			minutes = parseInt(seconds_left / 60);
			seconds = parseInt(seconds_left % 60);
			countdown.innerHTML = days + "d," + hours + "h,"
			+ minutes + "m," + seconds + "s"; 
			if(days==0 && hours==0 && minutes==0 && seconds==0){
				swal({
		  title: "Time is over!",
		  text: " ",
		  timer: 2000,
		  showConfirmButton: false
		});

			} 
		}, 1000);


	}
	function checkifadmin(username){
		 if(username===userlogin){
           document.getElementById('contestteam').style.display = 'block';
           $('#contesteditproblems').show();
           $('#editcontestbtn').show();
           $('#addtestcase').show();
           $('#contestlanguageproblem').hide();
           $('#contesttestcaseexamplediv').hide();
           document.getElementById('joinbtn').style.display = 'none';
           
           $("#editContestButton").show();
           $(".edit-order").show();
			canedit="yes";
			}
           else{
			   $('#addtestcase').hide();
           $('#contestlanguageproblem').show();
           $('#contesttestcaseexamplediv').show();
			   $('#contestquestionsubmit').show(1000);
			
			  document.getElementById('joinbtn').style.display = 'block';
			   
			   }		 
	}
	function changeprofile(username){
			$('#titlePage').text(username+"'s contests");
			document.title = username;
			document.getElementById('backtoprofile').style.display = 'block';
			document.getElementById('logout').style.display = 'none';
			document.getElementById('users').style.display = 'none';
			document.getElementById('setting').style.display = 'none';			
			document.getElementById('createcontestdiv').style.display = 'none';		
					 
}
	function checkprofile(username){
		
		 $.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 				
            success: function (data) {
			 userlogin=(JSON.parse(data)).username;
           if(username===userlogin){
			   
         // document.getElementById('info').style.display = 'none';
         	}
           else{
			  changeprofile(username);
			   
			   }				
            },
           error: function (request) {  
			    if(request.status===405){
				   window.location.replace("/user/"); 
			   }              
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;  	      	      		
      		}
		
		});
	}
	function convertUTCDateToLocalDate(date) {
		var d=moment.utc(date).local();
		var s = d.format("YYYY-MM-DD HH:mm:ss");	
		return (s);   
	}
	function reset(){
	//reset menu
		$('#contestteam').css('background-color', '#1B325F');
		$('#questions').css('background-color', '#1B325F');
		$('#rank').css('background-color', '#1B325F');
	//reset main div
		$("#contestrank").hide();
		$("#contestinformation").hide();
		$("#addproblemdiv").hide();
		$("#contestquestions").hide();
		$("#contestteams").hide();
		$("#contestaddquestions").hide();
		$("#contestquestion").hide();
		$("#createcontestdiv").hide();
		
		$("#problemhead").hide();
		$("#maintitr").show();

	}
	function getidprofile(id){    		   		
	  $.ajax({
				type: "GET",
				url : '/user/'+id+'/teams/',
				dataType: "html", 				
				success: function (data) {
					var data=(JSON.parse(data)).teams;
					
					 var tr;
			for (var i = 0; i < data.length; i++) {
				tr = $('<tr/>');
				tr.append('<td style="display:none">' + data[i].contests.id + "</td>");
				tr.append("<td>" + data[i].contests.name + "</td>");
				tr.append("<td>" + data[i].contests.starts_on + "</td>");
				tr.append("<td>" + data[i].contests.ends_on + "</td>");
				tr.append("<td>" + data[i].name + "</td>");
				$('#contestinfo').append(tr);
			}

				},
			   error: function (request) {
				    if(request.status===405){
				   window.location.replace("/user/"); 
			   }                
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;       	      		
				}
			});
	  } 
	function addRowHandlers() {
		var table = document.getElementById("tableId");
		var rows = table.getElementsByTagName("tr");
		for (i = 0; i < rows.length; i++) {
			var currentRow = table.rows[i];
			var createClickHandler = 
				function(row) 
				{
					return function() { 
											var cell = row.getElementsByTagName("td")[0];
											var id = cell.innerHTML;
											//alert("id:" + id);
									 };
				};

			currentRow.onclick = createClickHandler(currentRow);
		}
	}
	function clearprobleminput(){
		$("#problemtitle").val('');
		$("#problemtimelimit").val('');
		$("#problemspacelimit").val('');
		$("#problemheader").val('');
		$("#problembody").val('');
		$("#problemfooter").val(''); 
		$("#problemtestcaseinput").val('');  
		$("#problemtestcaseoutput").val('');
	}
	function backtocontestpage(){
		window.history.pushState("", "title", "/contest/"+contestname+"/");
		checkifadmin(contestadmin);
		reset();
		$('#titlePage').html("Details") ;	
		$('#contestinformation').show(1000);
	}
	function changecontestpage(contestname){		
		document.title = contestname;
		$( '#getcontestname ' ).append(contestname);
		$('#contestleftmenu').show();
		$('#contestinformation').show();
		$('#leftmenu').hide();
		$('#contestinfoforusers').hide();
		$('#createcontestdiv').hide();
		document.getElementById('titlePage').innerHTML="Details" ;
		$('#questions').css('background-color', '#1B325F');
		$('#rank').css('background-color', '#1B325F');
		$('#team').css('background-color', '#1B325F');
		$('#backtoprofile').css('background-color', '#1B325F');
		
							
		}
	function getAbsolutePath() {
    
    var pathName = loc.pathname.substring(0, 9);
    return pathName;
}
	function showproblem(){
		$('#contestinfoforusers').hide();
			$('#maintitr').hide();
			$('#problemhead').show();
			$('#contestinformation').hide();
			$('#contestquestions').hide();
			$('#contestquestion').show();
			$('#contestrank').hide()	
			$('#contestaddquestions').hide()
			$('#addproblemdiv').hide()
	}
	function loadquestiondiv(id){	

	 //show problem
	 $.ajax({
            type: "GET",
            url :"/contest/"+contestid+"/problems/"+(parseInt(id)+1)+"/",
            dataType: "html",  				
            success: function (data) {
			document.getElementById('titleproblem').innerHTML=((JSON.parse(data)).title) ;	
			document.getElementById('orderproblem').innerHTML=((JSON.parse(data)).order);		
			problemid=((JSON.parse(data)).id);
			$("#contestspacelimitdiv").append((JSON.parse(data)).space_limit);
			$("#contesttimelimitdiv").append((JSON.parse(data)).time_limit );
			$("#contestheaderdiv").html((JSON.parse(data)).header);
			$("#contestbodydiv").html((JSON.parse(data)).body);
			$("#contestfooterdiv").html((JSON.parse(data)).footer);
			if(((JSON.parse(data)).testcases)!=""){		
				$("#testcaseinput").html(((JSON.parse(data)).testcases[0]).input);
				$("#testcaseoutput").html(((JSON.parse(data)).testcases[0]).output);
			}
			else{
				$("#contesttestcaseexamplediv").hide();				
			}
			$("#idproblem").html((JSON.parse(data)).id);												
            },
          error: function (request, status, error) {
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   } 			    
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;  			         
           }   
    });
   
if(canedit==="no"){
    $.ajax({
            type: "GET",
            url :"/user/"+userloginid+"/contest/"+contestid+"/",
            dataType: "html",
            contentType: "application/json",		 				
            success: function (data) {
			showproblem();
			 problemid=(parseInt(id)+1);
			 $('#contestteam').css('background-color', '#1B325F');
			 $('#questions').css('background-color', '#355C7D');
			teamid=((JSON.parse(data)).id);
			$("#idteam").html((JSON.parse(data)).id);
			
			$("#input-2").fileinput({			
						showUpload: true,
						uploadUrl:  " ",
						//uploadAsync: false,
						maxFileCount: 1,
						layoutTemplates: {
							preview: '<div class="file-preview {class}">\n' +
								'    {close}\n' +
								'    <div class="close fileinput-remove">×</div>\n' +
								'    <div class="file-preview-thumbnails">\n' +
								'    </div>\n' +
								'    <div class="clearfix"></div>' +
								'    <div class="file-preview-status text-center text-success"></div>\n' +
								'    </div>\n' +
								'</div>',

							footer: '<div class="file-thumbnail-footer">\n' +
								'    <div class="file-caption-name" style="width:{width}">{caption}</div>\n' +
								'    {progress} {actions}\n' +
								'</div>',
							actions: '<div class="file-actions">\n' +
								'    <div class="file-footer-buttons">\n' +
								'        {delete}' +
								'    </div>\n' +
								'    <div class="clearfix"></div>\n' +
								'</div>',     
					}	 														
				}); 	       
			$('#input-2').on('filebatchpreupload', function(event, data, previewId, index, jqXHR) {
			var filetype= $('.nav-pills > li.active a').attr("id");
			$('#input-2').fileinput('enable');
			var file1 = event.target.files[0];
				//alert(filetype);
		   $.ajax({
            type: "POST",
            url : "/contest/submit/"+contestid+"/"+teamid+"/"+(parseInt(id)+1)+"/"+filetype+"/",
           contentType: false,
           processData: false,
            dataType: "html",			
            data:file1,
            success: function (data) {
                if((JSON.parse(data)).status !="Accepted"){
								 swal("OoOops!!!", "You have:"+(JSON.parse(data)).status, "error");
								 	
								}else{
									swal("Accepted!","Your answer submited successfully", "success");
								}
                $('#input-2').fileinput('clear');
				  
            },
            error: function (request, status, error) {
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
				 $('#input-2').fileinput('clear');
            }
              });	
							
		});	
		$('#input-2').fileinput('enable');		
			},
          error: function (request, status, error) { 
			   if(request.status===405){
				   window.location.replace("/user/"); 
			   }			  
		   swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
	   }
							                        
    });
  }else{  
	  showproblem();
	 problemid=(parseInt(id)+1);
	 $('#contestteam').css('background-color', '#1B325F');
	 $('#questions').css('background-color', '#355C7D');
  $("#input-1").fileinput({
			
		showUpload: true,
		uploadUrl: " ",
		uploadAsync: false,
		maxFileCount: 1,
		layoutTemplates: {
			preview: '<div class="file-preview {class}">\n' +
				'    {close}\n' +
				'    <div class="close fileinput-remove">×</div>\n' +
				'    <div class="file-preview-thumbnails">\n' +
				'    </div>\n' +
				'    <div class="clearfix"></div>' +
				'    <div class="file-preview-status text-center text-success"></div>\n' +
				'    </div>\n' +
				'</div>',

			footer: '<div class="file-thumbnail-footer">\n' +
				'    <div class="file-caption-name" style="width:{width}">{caption}</div>\n' +
				'    {progress} {actions}\n' +
				'</div>',
			actions: '<div class="file-actions">\n' +
				'    <div class="file-footer-buttons">\n' +
				'        {delete}' +
				'    </div>\n' +
				'    <div class="clearfix"></div>\n' +
				'</div>',     
    }	 
													
	}); 
	       

	$('#input-1').on('filebatchpreupload', function(event, data, previewId, index, jqXHR) {
		var file = event.target.files[0];
		   $.ajax({
            type: "POST",
            url : "/contest/" + contestid + "/testcase/" +problemid + "/",
           contentType: false,
           processData: false,
            dataType: "html",			
            data:file,
            success: function (data) {
                swal("Good!", "add testcase successfully", "success");
                $('#input-1').fileinput('clear');
				  
            },
            error: function (request, status, error) {
				 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
				 $('#input-1').fileinput('clear');
            }
              });
	
							
		});	
		$('#input-1').fileinput('enable');
		
   
}
}
	function acceptorrejectteam(id,flag){
		
		 $.ajax({
	  
            type: "PUT",
            url : "/contest/"+contestid+"/team_acceptation/"+id+"/",
            contentType: "application/json",
            dataType: "html",			
            data: '{ "acceptation":"'+flag+'"}',
            beforeSend: function() {
					$('#acceptorrrejectloading').show();
					 $('.rejectteam').prop('disabled', true);
					   $('.acceptteam').prop('disabled',true);
				},
            success: function (data) {
				swal({
					  title: "Good!",
					  text: "Your changes submited successfully",
					  type: "success",
					 
					  closeOnConfirm: true,
					  //showLoaderOnConfirm: true,
					},
					function(){
					  
						window.location.replace("/contest/"+contestname+"/");
					});    
             
              
            },
            error: function (request, status, error) {
				 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
				swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
				
            },
            complete: function(){
					   $('.rejectteam').prop('disabled', false);
					   $('.acceptteam').prop('disabled', false);
					$('#acceptorrrejectloading').hide();
				}
              });
	

}	
	$("#questions").click(function() {
	window.history.pushState("", "title", "/contest/"+contestname+"/");
	  $.ajax({
				type: "GET",
				url :"/contest/"+contestid+"/problems/",
				dataType: "html",
			   
				success: function (data) {
				reset();//added by milad
				document.getElementById('titlePage').innerHTML="Problems" ;
				$('#contestquestions').show();				
				 $('#questions').css('background-color', '#355C7D');
				 if (canedit==="yes"){
					 document.getElementById('addproblemdiv').style.display = 'block';
				 }
				var data=(JSON.parse(data)).problems;
					 var tr;
					 problemnumber=data.length;
					 if(flagproblemlist==false){
				for (var i = 0; i < data.length; i++) {
					li = $('<li id="Q'+i+'">');

					li.append('<input type="hidden" value="' + data[i].id + '" />');
					li.append('<div class="subset-question order">' + data[i].order + '</div>');
					li.append('<div class="subset-question title">' + data[i].title + '</div>');
					li.append('<div class="subset-question title"><button id="'+i +'" class="hover-button viewproblem">Show</button></div>');
					//tr.append("<td>" + data[i].name + "</td>");
					$('.sortable').append(li);
				}
					$('.viewproblem').click(function(){
						
						id = $(this).attr('id');
						loadquestiondiv(id);
					});
					flagproblemlist=true;
					}
				},
					error: function (request, status,error) {
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
				  swal("Sorry!", (JSON.parse(request.responseText)).errors, "error");
			   }
		});

	 });	 
	 $("#editproblemtbtn").click(function() {
		$('#maintitr').show();
		reset();
		 document.getElementById('problemhead').style.display = 'none';
		document.getElementById('titlePage').innerHTML="Edit Problems" ;
		document.getElementById('addproblemsubmitbtn').style.display = 'none';
		document.getElementById('editproblemsubmitbtn').style.display = 'block';
		$('#contestaddquestions').show();
		 $('#contestteam').css('background-color', '#1B325F');
		 $('#questions').css('background-color', '#355C7D');		
				//$("#contesttestcaseexamplediv").val();
		 $("#problemtitle").val($("#titleproblem").text());
		 $("#problemtimelimit").val($("#contesttimelimitdiv").text());
		 $("#problemspacelimit").val($("#contestspacelimitdiv").text());
		 $("#problemheader").val($("#contestheaderdiv").text());
		 $("#problembody").val($("#contestbodydiv").text());
		 $("#problemfooter").val($("#contestfooterdiv").text()); 
		 $("#problemtestcaseinput").val($("#testcaseinput").text());  
		 $("#problemtestcaseoutput").val($("#testcaseoutput").text()); 			
			 
	 });
	 $("#editproblemsubmitbtn").click(function() {
		var problemtitle = $("#problemtitle").val();
		var problemtimelimit = $("#problemtimelimit").val();
		var problemspacelimit = $("#problemspacelimit").val();
		var problemheader = $("#problemheader").val();
		var problembody = $("#problembody").val();
		var problemfooter = $("#problemfooter").val(); 
		var problemtestcaseinput = $("#problemtestcaseinput").val();  
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();
		//var problemid=$("#idproblem").val();
		var datawotestcase={"problems": [{ "id":problemid ,"title":  problemtitle , "time_limit" : problemtimelimit , "space_limit" : problemspacelimit , "header" : problemheader, "body" :  problembody , "footer" : problemfooter }]};
		var datawtestcase={"problems": [{"id":problemid,"title": problemtitle , "time_limit" : problemtimelimit , "space_limit" :  problemspacelimit , "header" :  problemheader, "body" : problembody , "footer" :  problemfooter ,"testcases": [ {"id":"1" ,"order":"1" , "input":problemtestcaseinput ,"output":problemtestcaseoutput } ]}]};
		if(problemtestcaseinput=="" && problemtestcaseoutput==""){
			var obj = datawotestcase;
		}
		else{	
			var obj = datawtestcase;

		}

	  $.ajax({
		  
				type: "PUT",
				url : "/contest/"+contestid+"/",
			   contentType: "application/json",
				dataType: "html",			
				data:JSON.stringify(obj),
				 beforeSend: function() {
					$('#addproblemloading').show();
					 $('#editproblemsubmitbtn').prop('disabled', true);
				},
				success: function (data) {
					swal("Sorry!","Edit problem successfully", "success") ; 
					clearprobleminput();
					backtocontestpage();
				},
				error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
					
				},
				  complete: function(){
					   $('#editproblemsubmitbtn').prop('disabled', false);
					$('#addproblemloading').hide();
				}
				  });
	  
	 });
	$("#logout").click(function() { 
		
	  $.ajax({
				type: "GET",
				url : '/user/logout/',
				dataType: "html",  				
				success: function () {
				window.location.replace("/user/");
				},
			  error: function (request, status, error) { 
				  window.location.replace("/user/");           
				}
				
		});
	  });
	$(".backtoprofile").click(function() { 
		 $.ajax({
				type: "GET",
				url : '/user/get_profile/',
				dataType: "html", 				
				success: function (data) {
					var userlogin=(JSON.parse(data)).username; 
					
					window.location.replace("/user/"+userlogin+"/");         				
				},
			   error: function (request) {                
					window.location.replace("/user/");  	      	      		
				}
			});
			});
	$("#addproblembtn").click(function() { 
	clearprobleminput(); 
	reset();
		document.getElementById('titlePage').innerHTML="Add Problems" ;
		$('#contestaddquestions').show(1000);
		document.getElementById('addproblemsubmitbtn').style.display = 'block';
		document.getElementById('editproblemsubmitbtn').style.display = 'none';
		 $('#contestteam').css('background-color', '#1B325F');
		 $('#questions').css('background-color', '#355C7D');
	});
	$("#addproblemsubmitbtn").click(function() { 		
		var problemtitle = $("#problemtitle").val();
		var problemtimelimit = $("#problemtimelimit").val();
		var problemspacelimit = $("#problemspacelimit").val();
		var problemheader = $("#problemheader").val();
		var problembody = $("#problembody").val();
		var problemfooter = $("#problemfooter").val(); 
		var problemtestcaseinput = $("#problemtestcaseinput").val();  
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();  
		var problemtestcaseinput = $("#problemtestcaseinput").val();
		var problemtestcaseoutput = $("#problemtestcaseoutput").val();
		var datawotestcase={"title": problemtitle, "time_limit" :  problemtimelimit , "space_limit" :  problemspacelimit , "header" : problemheader , "body" :  problembody , "footer" :  problemfooter };
		var datawtestcase={"title": problemtitle , "time_limit" :  problemtimelimit , "space_limit" :  problemspacelimit , "header" :problemheader , "body" :  problembody , "footer" :  problemfooter ,"testcases": [ { "input":problemtestcaseinput ,"output":problemtestcaseoutput } ]};
		 var obj={};
		if(problemtestcaseinput=="" && problemtestcaseoutput==""){
			
			 obj = datawotestcase;

		}
		else{	
			obj = datawtestcase;
		}
			
		$.ajax({
				type: "POST",
				url : "/contest/"+contestid+"/problem/",
			   contentType: "application/json",
				dataType: "html",			
				data: JSON.stringify(obj),
				 beforeSend: function() {
					 $('#addproblemsubmitbtn').prop('disabled',true);
					$('#addproblemloading').show();
				},
				success: function (data) {
					swal({
						  title: "Good!",
						  text: "add problem successfully",
						  type: "success",
						 
						  closeOnConfirm: false,
						  showLoaderOnConfirm: true,
						},
						function(){
						clearprobleminput(); 
					window.location.replace("/contest/"+contestname+"/");
						});    
				 
					 
				},
				error: function (request, status, error) {
					 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ; 
				
				  
				},
				complete: function(){
					   $('#addproblemsubmitbtn').prop('disabled', false);
					$('#addproblemloading').hide();
				}
		 });
	});	
	$("#cancleproblemsubmitbtn").click(function() { 
		clearprobleminput();
		 backtocontestpage();
	});	
	$("#getusername").click(function() {
				window.location.replace("/user/"+username+"/");
			});
	$("#joinbtn").click(function() {
		swal({
	  title: " ",
	  text: "Please wirte your team name",
	  type: "input",
	  showCancelButton: true,
	  closeOnConfirm: false,
	  showLoaderOnConfirm: true,
	  animation: "slide-from-top",
	  inputPlaceholder: "Team name"
	},
	function(inputValue){
	  if (inputValue === false) return false;
	  
	  if (inputValue === "") {
		swal.showInputError("You need to write something!");
		return false;
	  }
	  //alert('{"contest_id": "' + contestid + '", "team_name" : "' + inputValue + '"}');
	  $.ajax({
				type: "POST",
				url :'/team/join_request/',
				data: '{"contest_id": "' + contestid + '", "team_name" : "' + inputValue + '"}',
				dataType: "html",
				contentType: "application/json",
				success: function (data) {
					swal("Good!","Your request submited successfully" , "success") ; 
				} ,
			  error: function (request, status, error) { 
			    if(request.status===405){
				   window.location.replace("/user/"); 
			   }
					swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;		              
			   }  
		});
	});	
	});	
	$("#backtoproblemlistbtn").click(function() {
		 backtocontestpage();
	});	
	$("#contestteam").click(function() { 
		 $('.rejectteam').prop('disabled', false);
		$('.acceptteam').prop('disabled', false);		
		  $.ajax({
				type: "GET",
				url :"/contest/"+contestid+"/pending_teams/",
				dataType: "html",  				
				success: function (data) {
				window.history.pushState("", "title", "/contest/"+contestname+"/");
				reset();//added by milad
				 $('#contestteams').show();
					document.getElementById('titlePage').innerHTML="Teams request" ;
					 $('#contestteam').css('background-color', '#355C7D');
					//alert(data);
					 if(flagteamlist==false){
						var data=(JSON.parse(data)).teams;
						if(data==""){
							$('#contestteams').html("there is no pending request to show");
						}
						//alert(data[0].name+","+data.length);
						 var tr;
						for (var i = 0; i < data.length; i++) {
							//alert(data[i].members.length);
							tr = '<tr id="'+data[i].id+'">';								
							tr+='<td><a href="#" id="p'+data[i].name+'">' + data[i].name + '</a></td>';
							
							
							if(data[i].members.length ==3){	
								tr+="<td>" + data[i].members[0].username +","+data[i].members[1].username +","+data[i].members[2].username + "</td>";		
							}
							else if(data[i].members.length ==2){	
								tr+="<td>" + data[i].members[0].username + ","+data[i].members[1].username +"</td>";	
							}
							else {	
								tr+="<td>" + data[i].members[0].username + "</td>";		
							}
							tr+='<td><a href="#" id="u'+data[i].owner.username+'">' + data[i].owner.username + '</a></td>';
							tr+='<td>  <button type="submit" class="btn btn-success submitteam" ><i class="fa fa-check"></i> Accept</button><button  type="submit" class="btn btn-danger rejectteam"><i class="fa fa-remove"></i> Reject</button> </td></tr>';
							
							$('#contestteamstbl').append(tr);
							$(("#p"+data[i].name)).attr("href",("/team/"+data[i].name+"/"))	;
							$(("#u"+data[i].owner.username)).attr("href",("/user/"+data[i].owner.username+"/"))	;
						}
						$('.rejectteam').click(function(){
						id = $(this).closest('tr').attr('id');
						acceptorrejectteam(id,false);
											
						});
						$('.submitteam').click(function(){
						id = $(this).closest('tr').attr('id');
						acceptorrejectteam(id,true);
										
						});	
						
						//alert(tr);	
						flagteamlist=true;
				}	
					
				},
			  error: function (request, status, error) { 
			    if(request.status===405){
				   window.location.replace("/user/"); 
			   }
						swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;		              
			   }  
		});
		
	});
	$("#rank").click(function( ){
			window.history.pushState("SADASD", "title", "/contest/"+contestname+"/details_page/");			
		});		
	$("#team").click(function() {
		window.location.replace("/user/"+username+"/team/");
	  });	
	$('#contestnameitem').click(function( ){
		backtocontestpage(); 
	});
	$editContest = function()
	{
		if ($("#editContestButton").html() == 'Edit')
		{
			$("#editContestButton").data('name', $('.editable').html());
			$('.editable').replaceWith($('<input class="editable" value="' + $('.editable').html() + '">'));

			$(".sector-block-contest").each(function()
			{
				if ($(this).find('div').html() == 'starts on')
				{
					$(this).data('data', $(this).find('p').html());
					$(this).find('p').replaceWith($('<input type="text" class="form-control" id="datetimepicker" value="' + $(this).find('p').html() + '" />'));
				}
				else if ($(this).find('div').html() == 'ends on')
				{
					$(this).data('data', $(this).find('p').html());
					$(this).find('p').replaceWith($('<input type="text" class="form-control" id="datetimepicker2" value="' + $(this).find('p').html() + '" />'));
				}
			});
			$("#datetimepicker").datetimepicker();
			$("#datetimepicker2").datetimepicker();
			document.getElementById("cancelContestButton").style.display = 'block';
			$("#editContestButton").html("Submit");
		}
		else
		{
			var myData = {};
			var isSend = false;
			if($("#datetimepicker").parent().data('data') != $("#datetimepicker").val() && $("#datetimepicker").val() != "")
			{
				var myRawData = $("#datetimepicker").val().split(' ');
				var myDate;
				myDate = new Date;
				myDate.setYear(myRawData[0].split('/')[2]);
				myDate.setMonth(myRawData[0].split('/')[0]-1);
				myDate.setDate(myRawData[0].split('/')[1]);
				if (myRawData[2] == 'PM')
				{
					myDate.setHours(myRawData[1].split(':')[0] + 12);
				}
				else
				{
					myDate.setHours(myRawData[1].split(':')[0]);
				}
				myDate.setMinutes((myRawData[1].split(':')[1])+21);
				myDate = new Date(myDate.toUTCString());
				myData["starts_on"] = myDate.getTime()/1000 + (myDate.getTimezoneOffset() * 6);
				//alert(myDate);
				isSend = true;
			}
			if ($("#datetimepicker2").parent().data('data') != $("#datetimepicker2").val() && $("#datetimepicker2").val() != "")
			{
				var myRawData = $("#datetimepicker2").val().split(' ');
				var myDate;
				myDate = new Date;
				myDate.setYear(myRawData[0].split('/')[2]);
				myDate.setMonth((myRawData[0].split('/')[0])-1);
				myDate.setDate(myRawData[0].split('/')[1]);
				
				if (myRawData[2] == 'PM')
				{
					myDate.setHours(myRawData[1].split(':')[0] + 12);
				}
				else
				{
					myDate.setHours(myRawData[1].split(':')[0]);
				}
				myDate.setMinutes(myRawData[1].split(':')[1]+21);
				myDate = new Date(myDate.toUTCString());
				myData["ends_on"] = myDate.getTime()/1000 + (myDate.getTimezoneOffset() * 6);
				
				isSend = true;
			}
			if ($(".editable").val() != $("#editContestButton").data('name'))
			{
				myData["name"] = $(".editable").val();
				isSend = true;
			}
			if (isSend)
			{
				$.ajax({
					type: "PUT",
					url: '/contest/' + $(".contest-id").val() +'/',
					dataType: "html",
					contentType: "application/json",
					data: JSON.stringify(myData),
					success: function (data) {
						swal("Good!","edited", "success");
						setTimeout(function(){ window.location = "/contest/" + $(".editable").val() + "/"; }, 2000);
					},
					error: function (request, status, error) {
						 if(request.status===405){
				   window.location.replace("/user/"); 
			   }
						swal("Sorry!", (JSON.parse(request.responseText)).errors, "error") ;
					}
				});
			}
		}
	};

	$cancelContest = function()
	{
		$('.editable').replaceWith($('<p class="editable">' + $('.editable').val() + '</p>'));
		$(".sector-block-contest").each(function(){
			if ($(this).find('div').html() == 'starts on' || $(this).find('div').html() == 'ends on')
			{
				$(this).find('input').replaceWith($('<p>' + $(this).data('data') + '</p>'));
			}
		});
		document.getElementById("cancelContestButton").style.display = 'none';
		$("#editContestButton").html("Edit");
	}

</script>
</html>
