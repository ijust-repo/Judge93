<html  lang="en">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Contests</title>
    <link href="{{ url_for('static', filename='../statics/css/bootstrap/bootstrap.css') }} " rel="stylesheet" />
    <link href="{{ url_for('static', filename='../statics/css/bootstrap/bootstrap-theme.css') }} " rel="stylesheet" />
    <script src="{{ url_for('static', filename='../statics/js/jquery-2.1.3.js') }}" /></script>

    <script src="{{ url_for('static', filename='../statics/js/bootstrap/bootstrap.js') }}" /></script>
	<script src="{{ url_for('static', filename='../statics/js/jquery.nicescroll.min.js') }}" /></script>	
    <link href="{{ url_for('static', filename='../statics/css/style.css') }}" rel="stylesheet" />
<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

</head>

<body>
	<ul class=" col-xs-3 col-md-2 leftmenu shadow " id="leftmenu" >
		
		<li class=" usernameitem " id="usernameitem">
			<a ><h4 id="getusername" class="leftmenuitem"></h4></a>
			<a ><h4 id="getidprof" class="leftmenuitem" style="display:none"></h4></a>
		</li>	
		
		<li  id="contestname" class="contestmenu" style="display:none" >
			
		 	<a  ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Contests name</h4></a>
		</li>
		<li  id="contestteam" class="contestmenu" style="display:none" >
			
		 	<a ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Contests team</h4></a>
		</li>
		<li  id="contest"  >
			
		 	<a href="/user/contest/" ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Contests</h4></a>
		</li>
		
		<li  id="team"  >
		 	<a href="/user/team/"><h4 class="leftmenuitem"><i class="fa fa-group" style=" width:20px; height:20px; "></i> Teams</h4></a>
		</li>
		
		<li  id="users"  >
		 	<a href="#users"><h4 class="leftmenuitem"><i class="fa fa-user" style="width:20px; height:20px; "></i> Users</h4></a>
		</li>
		
		<li  id="setting"  >
		 	<a href="/user/setting/"><h4 class="leftmenuitem"><i class="fa fa-gears" style=" width:20px; height:20px; "></i> Settings</h4></a>
		</li>
		
		<li  id="logout"   >
		 	<a href="#logout"><h4 class="leftmenuitem"><i class="fa fa-sign-out" style=" width:20px; height:20px; "></i> Log out</h4></a>
		</li>
		<li  id="backtoprofile" style="display:none" >
		 	<a href="/user/home/"><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i>Back to profile</h4></a>
		</li>

	</ul>
	<ul class=" col-xs-3 col-md-2 leftmenu shadow " id="contestleftmenu" style="display:none">
		
		<li class=" usernameitem " id="contestnameitem">
			<a ><h4 id="getcontestname" class="leftmenuitem">contest name</h4></a>
			<h4 id="getidcontest" style="display:none"></h4>
		</li>	
		
		<li  id="questions" class=" usernameitem " >
			
		 	<a  ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Questions</h4></a>
		</li>
		
		<li  id="rank"  >
			
		 	<a  ><h4 class="leftmenuitem"><i  class="fa fa-laptop" style="width:20px; height:20px;"> </i> Rank list</h4></a>
		</li>
		
		<li  id="team"  >
		 	<a ><h4 class="leftmenuitem"><i class="fa fa-group" style=" width:20px; height:20px; "></i> Teams</h4></a>
		</li>
		
		<li  id="backtoprofile"  >
		 	<a href="#back" ><h4 class="leftmenuitem"><i class="fa fa-mail-reply"style=" width:20px; height:20px; "></i>Back to profile</h4></a>
		</li>

	</ul>

	<div id="createContest" class="form-dialog">
        <div>
            <a href="#" title="Close" class="close-button">X</a>
            <form>
                <div class="question">
                    <input type="text" id="contest_name" required/>
                    <label>Contest Name</label>
                </div>
                <label style="margin-top:10px;">starts</label>
                <input type="datetime-local" required id="contest_start" style="width:100%;margin-top:-8px;" />
                <label style="margin-top:10px;">ends</label>
                <input type="datetime-local" required id="contest_end" style="width:100%;margin-top:-8px;" />
                <button id="create_contest_button" type="submit" class="submit-button">Submit</button>
            </form>
        </div>
    </div>

    <div class="col-xs-offset-3 col-md-offset-2 row">
		<div class="col-xs-12 col-md-12 maintitr">
			<p id="titlePage">Contests</p>
			<div><a href="#createContest"><button class="hover-button close-page">Create Contest</button></a></div>
		</div>
	</div>
	<div class="col-xs-offset-3 col-md-offset-2 row">
      	<div id="contents" class="contents  " >
				<div id="contestinfoforusers"class="CSSTableGenerator" >
					
			<table id="contestinfo">
                   <tr>
					   <td style="display:none"> id </td>
					   <td > Name </td>

					   <td > Sart on </td>
					    <td> End on </td>
					    <td > Your team</td>
					    <td > Your rank</td>
					     
					</tr>
                </table>
                </div>
                <div id="contestquestions" class="questions">
				
				</div>
				<div id="contestquestion" class="question">
				
				</div>
				<div id="contestrank" class="rank">
				
				</div>
				<div id="contestteam" class="team">
				
				</div>
					 
	    </div>
   	</div>
   

</body>



<script>
	$(document).ready(function () {
 $('#contest').css('background-color', '#355C7D');

  //show contest

  function getidprofile(id){    		   		
  $.ajax({
            type: "GET",
            url : '/user/'+id+'/teams/',
            dataType: "html", 				
            success: function (data) {
				var data=(JSON.parse(data)).teams;
				 var tr;
        for (var i = 0; i < data.length; i++) {
            tr = $('<tr/>');
            tr.append('<td style="display:none">' + data[i].contests.id + "</td>");
            tr.append("<td>" + data[i].contests.name + "</td>");
            tr.append("<td>" + data[i].contests.starts_on + "</td>");
            tr.append("<td>" + data[i].contests.ends_on + "</td>");
            tr.append("<td>" + data[i].name + "</td>");
            $('#contestinfo').append(tr);
        }

            },
           error: function (request) {                
				alert("this user not found");	      	      		
      		}
		});
  } 
  
  //end show contest 
   //show username	      		   		
  $.ajax({
            type: "GET",
            url : '/user/get_profile/',
            dataType: "html", 				
            success: function (data) {	
           $( '#getusername ' ).html((JSON.parse(data)).username);
           getidprofile((JSON.parse(data)).id); 
           $( '#getidprof ' ).html((JSON.parse(data)).id);  				
            },
           error: function (request) {                
				alert("this user not found");	      	      		
      		}
		});
		
//end show username

 
  function addRowHandlers() {
    var table = document.getElementById("tableId");
    var rows = table.getElementsByTagName("tr");
    for (i = 0; i < rows.length; i++) {
        var currentRow = table.rows[i];
        var createClickHandler = 
            function(row) 
            {
                return function() { 
                                        var cell = row.getElementsByTagName("td")[0];
                                        var id = cell.innerHTML;
                                        alert("id:" + id);
                                 };
            };

        currentRow.onclick = createClickHandler(currentRow);
    }
}



		$('.close-page').removeClass('close-page').addClass('open-page');
		$('#create_contest_button').click(function() {
			var name = $("input#contest_name").val();

			var start = $("input#contest_start").val();
			var startDate = new Date(start);
			startDate = new Date(startDate.toUTCString());
			var startMillis = startDate.getTime()/1000 + (startDate.getTimezoneOffset() * 6);

			var end = $("input#contest_end").val();
			var endDate = new Date(end);
			endDate = new Date(endDate.toUTCString());
			var endMillis = endDate.getTime()/1000 + (endDate.getTimezoneOffset() * 6);

			$.ajax({
          		type: "POST",
          		url : '/contest/',
          		contentType: "application/json",
          		dataType: "html",
          		data: '{"name" : "' + name + '", "starts_on" : "' + startMillis + '", "ends_on" : "' + endMillis + '"}',
          		success: function (data) {
              		alert(" Contest successfully Created ");
          		},
          		error: function (request, status, error) {
            		if (request.status === 409) {
              			alert(" Contest with this name already exists! ");
            		} else if (request.status === 406) {
              			alert(" Start date must be earlier than end date! or Start date must be later than now! or fields required ");
            		}
          		}
        	});
			
		});
	});

 


</script>
</html>
